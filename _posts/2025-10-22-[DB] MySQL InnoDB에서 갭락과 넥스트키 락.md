---
title: "[DB] MySQL InnoDB에서 갭락과 넥스트키 락"
date: 2025-10-22
categories: [DB]
tags: [TIL, DB]
---

# # MySQL InnoDB에서 갭락과 넥스트키 락이란?

MySQL InnoDB에서 갭락(Gap Lock)과 넥스트키 락(Next-Key Lock)은 동시성 제어를 위해 사용되는 잠금 메커니즘으로, 특히 팬텀 리드(Phantom Read)를 방지하는 데 중요한 역할을 한다.


**갭락**은 **인덱스의 두 값 사이의 "갭"에 설정되는 잠금**이다. 예를 들어, 인덱스에 값이 10과 20이 있을 때, 갭락은 10과 20 사이의 공간(즉, 11부터 19까지)에 설정될 수 있다. 갭락은 **다른 트랜잭션이 이 갭에 새로운 값을 삽입하는 것을 방지**하여, 트랜잭션이 실행되는 동안 데이터의 일관성을 유지한다.

**넥스트키 락**은 **갭락과 행 락(Row Lock)을 결합한 형태**로, 인덱스의 특정 값과 그 값 앞의 갭에 동시에 잠금을 설정한다. 예를 들어, 인덱스에 값이 10과 20이 있을 때, 넥스트키 락은 값 10에 대한 행 락과 10과 20 사이의 갭에 대한 갭락을 동시에 설정한다. 이를 통해 트랜잭션이 실행되는 동안 해당 인덱스 범위 내에서 데이터의 일관성을 더욱 강화할 수 있다.

이 두 잠금 메커니즘은 팬텀 리드를 방지하는 데 중요한 역할을 한다. 팬텀 리드는 한 트랜잭션이 특정 조건에 맞는 행을 조회한 후, 다른 트랜잭션이 그 조건에 맞는 새로운 행을 삽입하거나 삭제하여 첫 번째 트랜잭션이 다시 조회할 때 결과가 달라지는 현상을 말한다. 갭락과 넥스트키 락을 사용하면 이러한 상황을 방지할 수 있다.

<br /><br />

### # 참고 : 팬텀 리드란?

팬텀 리드는 데이터베이스 트랜잭션에서 발생할 수 있는 현상으로, **한 트랜잭션이 특정 조건에 맞는 행을 조회한 후, 다른 트랜잭션이 그 조건에 맞는 새로운 행을 삽입하거나 삭제하여 첫 번째 트랜잭션이 다시 조회할 때 결과가 달라지는 상황**을 의미한다. 예를 들어, 트랜잭션 A가 "나이가 30세 이상인 모든 사용자"를 조회한 후, 트랜잭션 B가 새로운 30세 이상의 사용자를 삽입하면, 트랜잭션 A가 다시 조회할 때 결과가 변경될 수 있다. 이는 데이터의 일관성을 해칠 수 있기 때문에, 갭락과 넥스트키 락과 같은 잠금 메커니즘을 통해 이를 방지한다.
<br /><br />

참고 : 
- [MySQL InnoDB에서 갭락과 넥스트키 락이란 무엇이며, 어떻게 팬텀 리드를 방지하나요?](https://www.maeil-mail.kr/question/93)
