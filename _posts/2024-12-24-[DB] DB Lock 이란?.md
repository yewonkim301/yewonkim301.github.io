---
title: "[DB] DB Lock 이란?"
date: 2024-12-24
categories: [DB]
tags: [TIL, DB]
---

## DB Lock이란?

데이터베이스에서 여러 트랜잭션이 동일한 데이터에 접근하려 할 때, 데이터의 일관성과 무결성을 보장하기 위해 데이터에 대한 접근을 제어하는 메커니즘이다.

이는 동시에 실행되는 트랜잭션 간 충돌 방지와 데이터 정합성을 유지하는 역할을 한다.

- 예시 :
트랜잭션 A가 데이터를 수정 중일 때, 트랜잭션 B는 해당 데이터를 읽거나 수정할 수 없도록 잠그는 것.

<br /><br />

### # DB Lock의 필요성

여러 트랜잭션이 동시에 실행되는 환경에서 발생할 수 있는 주요 문제의 예는 아래와 같다.

1. **Dirty Read (더티 리드)** :
커밋되지 않은 데이터를 다른 트랜잭션이 읽어 잘못된 결과를 가져오는 문제.
- 예: A 트랜잭션이 은행 계좌 잔액을 수정 후 롤백했지만, B 트랜잭션은 이미 잘못된 잔액을 읽음.

<br />

2. **Non-repeatable Read (반복 불가능한 읽기)** :
동일 트랜잭션 내에서 같은 데이터를 읽었지만 값이 달라지는 문제.
- 예: 첫 번째 읽기 후 다른 트랜잭션이 값을 수정한 후, 재읽기 시 값이 변경됨.

<br />

3. **Lost Update (업데이트 손실)** :
두 트랜잭션이 동시에 데이터를 수정하려 할 때, 한쪽의 변경 사항이 덮어써지는 문제.
- 예: A 트랜잭션이 데이터를 수정한 후 B 트랜잭션이 다시 덮어써 A의 변경이 사라짐.

<br /><br />

### # DB Lock의 주요 종류

**1. 공유 락 (Shared Lock, S Lock)**

데이터를 읽을 때 사용하는 락이다. 여러 트랜잭션이 동시에 데이터를 읽을 수 있지만, 수정은 불가하다.

- 예: 고객 정보를 여러 사용자가 조회하지만, 수정은 대기

<br />

**2. 배타 락 (Exclusive Lock, X Lock)**

데이터를 수정할 때 사용하는 락이다. 한 트랜잭션만 접근 가능하며, 다른 트랜잭션의 읽기와 수정 모두 차단한다.

- 예: 상품 재고를 수정하는 동안 다른 사용자는 조회도 불가

<br />

**3. 비관적 락 (Pessimistic Locking)**

데이터를 조회하거나 수정할 때 즉시 락을 걸어 다른 트랜잭션 접근을 차단한다. 데이터 충돌 가능성이 높은 환경에서 사용한다.

- 예: 은행 계좌의 잔액 조회와 수정에서 다른 트랜잭션 차단

<br />

**4. 낙관적 락 (Optimistic Locking)**

락을 걸지 않고 데이터 수정 시점에만 충돌 여부를 확인한다. 데이터의 버전 번호나 타임스탬프를 사용한다.

- 예: 상품 정보를 수정하려는 두 트랜잭션이 충돌 시점에만 문제를 감지

<br />

**5. 명명된 락 (Named Lock)**

특정 이름으로 락을 설정해 명시적으로 리소스 접근을 제어한다.

- 예: 보고서 생성 작업을 직렬화하여 동시에 여러 사용자가 접근하지 못하도록 제한.

<br />

**6. 분산 락 (Distributed Lock)**

여러 시스템이나 인스턴스에서 동일한 자원에 접근할 때 사용한다. Redis와 같은 분산 환경에서 구현된다.

- 예: 공연 예약 시스템에서 동일한 좌석에 대한 중복 예약 방지

<br /><br />

### # 실제 사용 사례

**1. PostgreSQL의 명명된 락**
특정 리소스나 작업에 대해 락을 설정해 직렬화된 작업을 보장한다.
- 예: 특정 보고서 생성 시 다른 트랜잭션 대기

<br />

**2. Redis를 활용한 분산 락**
여러 서버에서 동일 데이터에 동시 접근을 방지한다.
- 예: 온라인 예약 시스템에서 좌석 충돌 방지

<br /><br />

### # 마무리

DB Lock은 데이터베이스의 무결성과 동시성을 보장하기 위한 중요한 메커니즘으로, 다양한 환경에 따라 적합한 락 전략을 선택해야 한다. 공유 락과 배타 락은 기본적인 동작을 제어하고, 비관적 락과 낙관적 락은 사용 시점과 데이터 충돌 가능성에 따라 적절히 선택된다. 분산 락은 현대의 다중 서버 환경에서 필수적인 도구이다.

따라서 데이터 무결성을 유지하려면 상황에 맞는 락 전략과 올바른 설계가 무엇보다 중요하다.

<br /><br />


참고 : 
- [DB 락(Lock)과 Lock의 종류에 대해 알아보자.](https://hstory0208.tistory.com/entry/%EB%9D%BDLock%EC%9D%B4%EB%9E%80-Lock%EC%9D%98-%EC%A2%85%EB%A5%98%EC%99%80-%EA%B5%90%EC%B0%A9%EC%83%81%ED%83%9CDeadLock)
- [DB Lock이란? (feat. Lock 종류, 블로킹, 데드락)](https://ksh-coding.tistory.com/121)
- [스파르타] 7. 장애 대응
